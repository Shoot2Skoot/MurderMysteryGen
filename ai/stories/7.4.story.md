# Story 7.4: Orchestrator - Provide Evidence Category Options to Agent

**Status:** COMPLETED

## Goal & Context

**User Story:** As a Developer, I want the orchestrator to load the master list of Evidence Categories and provide a relevant sub-list (or the full list) of these categories as input to the `EvidenceGenerationAgent`.

**Context:** This story integrates the master list of evidence categories (created in Story 7.1) into the main workflow. The `main_orchestrator.py` will be responsible for loading this list. Then, before calling the `EvidenceGenerationAgent` (enhanced in Story 7.3) for each suspect, the orchestrator will prepare and pass a selection of these categories to the agent. This ensures the agent has a defined set of category options to choose from, promoting variety in evidence types.

## Detailed Requirements

- Modify `src/mystery_ai/main_orchestrator.py`.
- Implement logic to load the master list of Evidence Categories (from the file created in Story 7.1, e.g., `evidence_categories.py` or `.json`).
- Before each call to `EvidenceGenerationAgent` (which happens per suspect):
    - Prepare a list of evidence category options to pass to the agent. This could be:
        - The full master list of categories.
        - A randomly selected sub-list of N categories (e.g., N=3-5) to encourage diversity per suspect or per evidence item.
        - A more sophisticated selection strategy (e.g., ensuring variety across all evidence generated for a case).
        - For initial implementation, passing the full list or a random sub-list is acceptable. The strategy can be refined later.
    - Pass this list of category options as an input parameter to the `EvidenceGenerationAgent`.

## Acceptance Criteria (ACs)

- AC1: The `main_orchestrator.py` successfully loads the master list of Evidence Categories from its defined location.
- AC2: The orchestrator correctly passes a list of evidence category options as an input parameter to the `EvidenceGenerationAgent` each time it is called.
- AC3: The strategy for providing category options (e.g., full list, random sub-list) is implemented and, if using a sub-list, ensures a reasonable variety of options can be presented to the agent over the course of generating evidence for multiple suspects.

## Technical Implementation Context

**Guidance:** Use the following details for implementation. Developer agent is expected to follow project standards in `docs/coding-standards.md` and understand the project structure in `docs/project-structure.md`.

- **Relevant Files:**
  - Files to Create: None.
  - Files to Modify:
    - `src/mystery_ai/main_orchestrator.py`

- **Key Technologies:**
  - Python (including `random.sample` if sub-selecting categories).

- **API Interactions / SDK Usage:**
  - Modifying the inputs provided when calling `EvidenceGenerationAgent`.

- **UI/UX Notes:**
  - N/A

- **Data Structures:**
  - Input: Master list of evidence categories (loaded from file).
  - Data to pass to agent: `evidence_category_options: List[str]`.

- **Environment Variables:**
  - None specific to this story.

- **Coding Standards Notes:**
  - Follow standards in `docs/coding-standards.md`.
  - Ensure robust loading of the categories list, handling potential file I/O issues.
  - If implementing sub-selection, ensure it doesn't lead to overly restrictive options for the agent.

## Testing Requirements

**Guidance:** Verify implementation against the ACs using the following tests.

- **Unit Tests:**
  - Test the logic for loading the evidence categories list.
  - If a sub-selection strategy is implemented, unit test that logic (e.g., correct number of items selected, items are from the master list).
- **Integration Tests:**
  - Run the main orchestration flow up to the point of calling `EvidenceGenerationAgent`.
  - Verify (e.g., through logging or a debugger) that the correct list of evidence category options is being passed to `EvidenceGenerationAgent`.
- **Manual/CLI Verification:**
  - Add logging in `main_orchestrator.py` to display the loaded master list and the specific list of options being passed to the `EvidenceGenerationAgent` for each call.
  - Run `python -m src.mystery_ai.main --theme "Your Theme"` and check logs.

## Tasks / Subtasks

- [ ] Task 1: In `main_orchestrator.py`, add logic to load the master list of Evidence Categories (from Story 7.1).
- [ ] Task 2: (Decision Point) Decide on the strategy for providing category options to `EvidenceGenerationAgent`:
    - Option A: Pass the full master list.
    - Option B: Pass a randomly selected sub-list of N items.
    - Option C: Other (define).
    For now, Option A or B is recommended.
- [ ] Task 3: Implement the chosen strategy to prepare the `evidence_category_options` list before each call to `EvidenceGenerationAgent`.
- [ ] Task 4: Modify the call to `EvidenceGenerationAgent` in the orchestrator to include this new input parameter.
- [ ] Task 5: Add logging to show the loaded master list and the options passed to the agent.
- [ ] Task 6: Test the updated orchestration to ensure lists are loaded and passed correctly (AC1, AC2, AC3).
- [ ] Task 7: Verify all Acceptance Criteria are met.

## Story Wrap Up (Agent Populates After Execution)

- **Agent Model Used:** `<Agent Model Name/Version>`
- **Completion Notes:** {Document the chosen strategy for providing category options (Task 2). Any challenges encountered.}
- **Change Log:**
  - Initial Draft
  - Marked as COMPLETED.

**Completion Notes:** `main_orchestrator.py` updated: `_load_and_select_attributes` now selects a sub-list of evidence categories. `_run_killer_mod_evidence_stage` accepts `attribute_options` and passes the selected evidence categories to `prepare_evidence_generation_input`. `prepare_evidence_generation_input` (in `evidence_generator.py`) now uses these passed options. Unit tests added.

**Change Log:**
- Initial Draft
- Marked as COMPLETED. 