# Story 6.3: Integrate Generated Names into `CaseInitializationAgent`

**Status:** Complete

## Goal & Context

**User Story:** As a Developer, I want to modify `CaseInitializationAgent` to use the dynamically generated thematic name lists for creating the victim's name.

**Context:** Building on Story 6.2 where the orchestrator retrieves thematic name lists from `PreInitializationIdeationAgent`, this story focuses on making `CaseInitializationAgent` consume these lists. Instead of inventing a victim's name from scratch based only on the theme, it will now select a first and last name from the provided lists to construct the `VictimProfile.name`.

## Detailed Requirements

- Modify `src/mystery_ai/agents/case_initializer.py`.
- Update the `CaseInitializationAgent`'s input handling to accept two new parameters:
    - A list of thematically appropriate first names.
    - A list of thematically appropriate last names.
    (These lists are sourced from the output of `PreInitializationIdeationAgent` via the orchestrator).
- Modify the agent's internal logic/prompt:
    - It should now be instructed to select one first name from the provided first name list.
    - It should select one last name from the provided last name list.
    - These selected names should be combined to form the `VictimProfile.name`.
- The agent must still generate the other victim details (`occupation`, `personality`, `cause_of_death`) thematically, and ensure the chosen name fits well with these other details.
- The agent must continue to output a complete and valid `VictimProfile` object.

## Acceptance Criteria (ACs)

- AC1: `CaseInitializationAgent` correctly processes new input parameters for the list of first names and the list of last names.
- AC2: The agent's internal logic successfully selects one first name from the provided list of first names and one last name from the provided list of last names.
- AC3: The `VictimProfile.name` field in the agent's output is populated using a combination of one first name and one last name selected from the provided lists.
- AC4: The chosen name combination is plausible and fits reasonably well with the other generated victim details and the overall theme.

## Technical Implementation Context

**Guidance:** Use the following details for implementation. Developer agent is expected to follow project standards in `docs/coding-standards.md` and understand the project structure in `docs/project-structure.md`.

- **Relevant Files:**
  - Files to Create: None.
  - Files to Modify:
    - `src/mystery_ai/agents/case_initializer.py` (primarily agent instructions/prompt).

- **Key Technologies:**
  - Python.
  - LLM Prompt Engineering.

- **API Interactions / SDK Usage:**
  - Modifying existing agent instructions.

- **UI/UX Notes:**
  - N/A

- **Data Structures:**
  - Input: In addition to the theme, the agent will receive `first_name_options: List[str]` and `last_name_options: List[str]` (or similar key names in its input dictionary).
  - Output: `VictimProfile` Pydantic model instance.

- **Environment Variables:**
  - None specific to this story.

- **Coding Standards Notes:**
  - Follow standards in `docs/coding-standards.md`.
  - The prompt modification needs to clearly instruct the LLM on how to use the provided lists for name selection, while still maintaining thematic coherence for other attributes.
  - Ensure the agent handles cases where lists might be shorter than expected, though Story 6.1 aims for N=50.

## Testing Requirements

**Guidance:** Verify implementation against the ACs using the following tests. Follow general testing approach in `docs/testing-strategy.md`.

- **Integration Tests (Agent Level):**
  - Test `CaseInitializationAgent` by providing a theme and mocked lists of first/last names.
  - Verify the output `VictimProfile.name` uses names from the provided lists.
  - Manually assess the plausibility and thematic fit of the chosen name with other generated details (AC4).
- **Manual/CLI Verification:**
  - Run the main orchestration (`python -m src.mystery_ai.main --theme "Your Theme"`) which now includes the full flow up to this point.
  - Inspect the `VictimProfile.name` in the final JSON output.
  - Add logging within `CaseInitializationAgent` to show the received name lists and the names it selected.

## Tasks / Subtasks

- [x] Task 1: Update `CASE_INITIALIZER_INSTRUCTIONS` in `src/mystery_ai/agents/case_initializer.py` to describe the new input parameters: a list of first names and a list of last names.
- [x] Task 2: Modify the prompt to instruct the LLM to select one first name from the provided list of first names.
- [x] Task 3: Modify the prompt to instruct the LLM to select one last name from the provided list of last names.
- [x] Task 4: Instruct the LLM to use these selected names to populate the `VictimProfile.name` field.
- [x] Task 5: Ensure the prompt still guides the LLM to generate other victim details (`occupation`, `personality`, `cause_of_death`) thematically and coherently with the chosen name.
- [x] Task 6: Add logging within the agent to record the received name lists and the specific names selected.
- [x] Task 7: Test with various themes and example name lists to ensure correct name selection and overall profile coherence.
- [x] Task 8: Verify all Acceptance Criteria are met.
  - AC1: `CaseInitializationAgent` correctly processes new input parameters for the list of first names and the list of last names. (Verified)
  - AC2: The agent's internal logic successfully selects one first name from the provided list of first names and one last name from the provided list of last names. (Verified)
  - AC3: The `VictimProfile.name` field in the agent's output is populated using a combination of one first name and one last name selected from the provided lists. (Verified)
  - AC4: The chosen name combination is plausible and fits reasonably well with the other generated victim details and the overall theme. (Verified through testing)

## Story Wrap Up (Agent Populates After Execution)

- **Agent Model Used:** `Claude 3.7 Sonnet (via Cursor)`
- **Completion Notes:** I updated the `CaseInitializationAgent` to use thematic name lists for creating victim names. The agent now receives two lists - `first_names` and `last_names` - as part of a `thematic_names` object in its input. The agent's instructions were modified to have it select one name from each list and combine them to form the victim's full name. Additionally, I enhanced the test code to provide sample thematic names and verify that the agent correctly selects from these lists. The implementation should be robust to varying list sizes, though it expects the lists to contain multiple options (ideally around 50 names as generated by the `PreInitializationIdeationAgent`).
- **Change Log:**
  - Initial Draft
  - Updated CaseInitializationAgent instructions to use thematic name lists
  - Updated test code to verify functionality
  - Updated story status to Complete 