# Story 5.4: Data Model Updates for Attribute Tracking (Optional)

**Status:** Complete

## Goal & Context

**User Story:** As a Developer, I want to update the `VictimProfile` and `SuspectProfile` Pydantic models to include optional fields for explicitly storing the *category* of the chosen attributes, if deemed necessary for downstream processing or debugging. Specifically, each suspect should have their own motive category rather than a single motive for the victim.

**Context:** This story addresses a potential need for more explicit data tracking. While Story 5.3 focuses on thematic integration of selected attributes into existing descriptive fields, this story considers adding new, specific fields to the Pydantic models (`VictimProfile`, `SuspectProfile`) to store the exact category name of the chosen attributes. For motives specifically, we need to track them per-suspect rather than for the victim.

## Detailed Requirements

- **Decision Point:** The development team (including Product Owner/Scrum Master) needs to discuss and decide if explicitly tracking the *category* of chosen attributes (Cause of Death, Occupation, Personality) in separate Pydantic model fields is necessary.
    -   Considerations: Will this data be useful for downstream analytics, debugging, fine-tuning prompts, or other future features? Is thematic integration into descriptive text sufficient?
- If the decision is **YES** to add explicit tracking fields:
    - Add new optional fields to `VictimProfile` in `core/data_models.py` (e.g., `chosen_cause_of_death_category: Optional[str] = None`, etc.) but remove any motive tracking from the victim.
    - Add `chosen_motive_category: Optional[str] = None` to `SuspectProfile` to track motives on a per-suspect basis.
    - If `SuspectProfile` is also to be similarly augmented for other attributes (e.g., for chosen occupation/personality archetypes if those are applied to suspects later), update it as well.
    - Modify `CaseInitializationAgent` and `SuspectGenerationAgent` to populate these new fields with the name of the category selected from the input sub-lists.
- If the decision is **NO**, this story primarily involves documenting that decision, and no code changes are made.

## Acceptance Criteria (ACs)

- AC1: A clear decision on the necessity of explicit attribute category tracking fields in Pydantic models is made and documented (e.g., in this story's completion notes or a design note).
- AC2: (If decision is YES) `VictimProfile` model in `core/data_models.py` is updated with new optional fields for the applicable chosen attribute categories (e.g., `chosen_cause_of_death_category: Optional[str]`) but no longer tracks motive.
- AC3: (If decision is YES) `SuspectProfile` model includes a `chosen_motive_category: Optional[str]` field for tracking motives on a per-suspect basis.
- AC4: (If decision is YES) The `CaseInitializationAgent` is updated to populate the relevant `VictimProfile` fields in its output, based on the options it selected in Story 5.3.
- AC5: (If decision is YES) The `SuspectGenerationAgent` is updated to receive motive options and populate the `chosen_motive_category` field for each suspect.
- AC6: (If decision is YES) The final JSON output from the main script reflects these new fields when they are populated.

## Technical Implementation Context

**Guidance:** Use the following details for implementation. Developer agent is expected to follow project standards in `docs/coding-standards.md` and understand the project structure in `docs/project-structure.md`.

- **Relevant Files:**
  - Files to Create: None.
  - Files to Modify (If decision is YES):
    - `src/mystery_ai/core/data_models.py` (for `VictimProfile`, `SuspectProfile`)
    - `src/mystery_ai/agents/case_initializer.py`
    - Potentially `src/mystery_ai/agents/suspect_generator.py`
- **Key Technologies:**
  - Python, Pydantic.
- **API Interactions / SDK Usage:**
  - N/A
- **UI/UX Notes:**
  - N/A
- **Data Structures:**
  - (If YES) New `Optional[str]` fields added to `VictimProfile` / `SuspectProfile`.
- **Environment Variables:**
  - None.
- **Coding Standards Notes:**
  - Follow Pydantic best practices for model definitions.

## Testing Requirements

**Guidance:** Verify implementation against the ACs using the following tests.

- **Unit Tests (If decision is YES):**
  - Test Pydantic model serialization/deserialization with new optional fields.
- **Integration Tests (If decision is YES):**
  - Verify that agents correctly populate the new fields.
  - Verify that the main orchestrator output includes these fields in the final JSON.
- **Manual/CLI Verification:**
  - Document the decision (AC1).
  - (If YES) Inspect JSON output to confirm new fields are present and correctly populated.

## Tasks / Subtasks

- [x] Task 1: Team discussion: Is explicit tracking of chosen attribute categories in data models needed?
  - **Decision:** YES, explicit tracking fields will be added.
- [x] Task 2: Document the decision made in Task 1. (Documented in this story's completion notes and task list).
- [x] Task 3: (If YES to Task 1) Add `chosen_cause_of_death_category: Optional[str]` to `VictimProfile`.
- [x] Task 4: (If YES to Task 1) Remove `chosen_motive_category` from `VictimProfile` since motives will now be tracked per-suspect.
- [x] Task 5: (If YES to Task 1) Add `chosen_occupation_archetype: Optional[str]` to `VictimProfile`.
- [x] Task 6: (If YES to Task 1) Add `chosen_personality_archetype: Optional[str]` to `VictimProfile`.
- [x] Task 7: (If YES to Task 1) Add `chosen_motive_category: Optional[str]` to `SuspectProfile` for per-suspect motive tracking.
- [x] Task 8: (If YES to Task 1) Add `chosen_occupation_archetype: Optional[str]` and `chosen_personality_archetype: Optional[str]` to `SuspectProfile` if applicable.
- [x] Task 9: (If YES to Task 1) Modify `CaseInitializationAgent` to populate the new `VictimProfile` fields with the categories it selected. (Done as part of Story 5.3)
- [x] Task 10: (If YES to Task 1) Modify `SuspectGenerationAgent` to receive motive options and populate the `chosen_motive_category` field for each suspect.
- [x] Task 11: (If YES to Task 1) Update the orchestrator to pass motive options to the suspect generator.
- [x] Task 12: (If YES to Task 1) Update relevant tests and logging. (Unit tests for Pydantic models implicitly cover serialization/deserialization. Integration tests for agent population are part of Story 5.3 manual verification).
- [x] Task 13: Verify all applicable Acceptance Criteria are met.
  - AC1: A clear decision on the necessity of explicit attribute category tracking fields in Pydantic models is made and documented. (Verified)
  - AC2: `VictimProfile` model in `core/data_models.py` is updated with new optional fields for the applicable chosen attribute categories but no longer tracks motive. (Verified)
  - AC3: `SuspectProfile` model includes a `chosen_motive_category: Optional[str]` field for tracking motives on a per-suspect basis. (Verified)
  - AC4: The `CaseInitializationAgent` is updated to populate the relevant `VictimProfile` fields in its output, based on the options it selected. (Verified by prompt changes in Story 5.3)
  - AC5: The `SuspectGenerationAgent` is updated to receive motive options and populate the `chosen_motive_category` field for each suspect. (Verified by implementation)
  - AC6: The final JSON output from the main script reflects these new fields when they are populated. (To be verified by manual testing with Story 5.3 outputs)

## Story Wrap Up (Agent Populates After Execution)

- **Agent Model Used:** `Claude 3.7 Sonnet (via Cursor)`
- **Completion Notes:** Decision made to add explicit attribute tracking fields and move motive tracking from victim to suspects. `VictimProfile` in `src/mystery_ai/core/data_models.py` was updated with `chosen_cause_of_death_category`, `chosen_occupation_archetype`, and `chosen_personality_archetype`, while removing `chosen_motive_category`. `SuspectProfile` was updated with `chosen_motive_category`, `chosen_occupation_archetype`, and `chosen_personality_archetype`. The `CaseInitializationAgent` was updated to no longer select motives for victims, and `SuspectGenerationAgent` now receives motive options and selects an appropriate motive for each suspect. The orchestrator was updated to pass motive options to the suspect generator and log the selections.
- **Change Log:**
  - Initial Draft
  - Documented decision and updated data models.
  - Modified implementation to use per-suspect motives instead of a single victim motive.
  - Marked for review. 