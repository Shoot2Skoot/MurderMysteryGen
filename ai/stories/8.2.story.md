# Story 8.2: Validate and Finalize Pydantic Data Models for Phase 2

**Status:** Draft

## Goal & Context

**User Story:** As a Developer, I want to ensure all Pydantic models impacted by Phase 2 changes are accurate, consistent, and well-documented, and that the main `docs/data-models.md` document (including the `CaseContext` schema) is updated to reflect the final state.

**Context:** This story focuses on data model hygiene and documentation after the implementation of Phase 2 features (Epics 5, 6, 7). It involves a final review of all Pydantic models in `src/mystery_ai/core/data_models.py` that were added or modified, ensuring their correctness, and then updating the canonical `docs/data-models.md` to reflect these changes.

## Detailed Requirements

- **Pydantic Model Review (`src/mystery_ai/core/data_models.py`):**
    - Systematically review all Pydantic models potentially affected or created during Phase 2. This includes:
        - `VictimProfile` (potentially with fields from Story 5.4).
        - `SuspectProfile` (potentially with fields from Story 5.4).
        - `EvidenceItem` (with new fields from Story 7.2: `evidence_category`, `narrative_function_description`).
        - `ThematicNameLists` (or similar, from Story 6.1, if defined in `data_models.py`).
        - `CaseContext` (to ensure it correctly incorporates all new/modified sub-models and any direct new fields).
    - For each reviewed model and its fields:
        - Verify correctness of field types.
        - Ensure clarity and accuracy of `Field(description="...")`.
        - Confirm appropriate use of `Optional` and default values.
        - Check for consistency in naming conventions.
- **Update `docs/data-models.md`:**
    - Regenerate the JSON schema for the top-level `CaseContext` model (e.g., using `CaseContext.model_json_schema(indent=2)`).
    - Replace or update the existing schema in `docs/data-models.md` with this new, complete schema.
    - Review and update the textual explanations in `docs/data-models.md` to accurately describe any new models, new fields within existing models, and the overall structure of the `CaseContext` after Phase 2.
    - Ensure descriptions of any new enum-like fields (e.g., if `evidence_category` was expected to come from a fixed list, this should be noted) are clear.

## Acceptance Criteria (ACs)

- AC1: All Pydantic models in `src/mystery_ai/core/data_models.py` related to Phase 2 features have been reviewed, and their field types, descriptions, optionality, and defaults are confirmed to be correct and consistent.
- AC2: The `docs/data-models.md` file contains the updated and complete JSON schema for the `CaseContext` model as of the end of Phase 2.
- AC3: The textual descriptions and explanations in `docs/data-models.md` accurately reflect all new or modified data structures introduced in Phase 2.

## Technical Implementation Context

**Guidance:** Use the following details for implementation. Developer agent is expected to follow project standards in `docs/coding-standards.md` and understand the project structure in `docs/project-structure.md`.

- **Relevant Files:**
  - Files to Create: None.
  - Files to Modify:
    - `src/mystery_ai/core/data_models.py` (for final validation and tweaks).
    - `docs/data-models.md` (for schema and textual updates).

- **Key Technologies:**
  - Python, Pydantic.
  - Markdown.

- **API Interactions / SDK Usage:**
  - Pydantic's `model_json_schema()` method.

- **UI/UX Notes:**
  - N/A

- **Data Structures:**
  - Focus is on ensuring the Pydantic models accurately represent the intended data structures.

- **Environment Variables:**
  - None.

- **Coding Standards Notes:**
  - Ensure `docs/data-models.md` is well-formatted and readable.
  - Pydantic field descriptions should be user/developer-friendly.

## Testing Requirements

**Guidance:** Verify implementation against the ACs using the following tests.

- **Unit Tests:**
  - Existing unit tests for Pydantic models should pass. If any model changes required test updates (e.g., due to changed optionality or new required fields from Story 5.4 or 7.2), those should be done as part of those stories, but a final check is good.
- **Manual Verification:**
  - Manually review `src/mystery_ai/core/data_models.py` against the implemented features of Epics 5, 6, and 7 (AC1).
  - Generate the `CaseContext` JSON schema and compare it against the content updated in `docs/data-models.md` (AC2).
  - Read through `docs/data-models.md` to ensure textual descriptions align with the schema and Phase 2 features (AC3).

## Tasks / Subtasks

- [ ] Task 1: Review `VictimProfile` in `data_models.py` for any Story 5.4 changes; ensure fields and descriptions are final.
- [ ] Task 2: Review `SuspectProfile` in `data_models.py` for any Story 5.4 changes; ensure fields and descriptions are final.
- [ ] Task 3: Review `EvidenceItem` in `data_models.py`; confirm `evidence_category` and `narrative_function_description` fields (Story 7.2) are final and descriptions are accurate.
- [ ] Task 4: Review `ThematicNameLists` (or similar model for Story 6.1 outputs), if defined in `data_models.py`; ensure it's final.
- [ ] Task 5: Review the overall `CaseContext` model in `data_models.py` to ensure it correctly incorporates all sub-models and reflects all Phase 2 data.
- [ ] Task 6: Write a small temporary script or add a line in `main_orchestrator.py` (under `if __name__ == '__main__':`) to print `CaseContext.model_json_schema(indent=2)`.
- [ ] Task 7: Run this script/main to generate the latest `CaseContext` JSON schema.
- [ ] Task 8: Open `docs/data-models.md`.
- [ ] Task 9: Replace the existing JSON schema section with the newly generated schema.
- [ ] Task 10: Update the textual descriptions in `docs/data-models.md` to explain any new models or fields (e.g., `EvidenceItem.evidence_category`, `EvidenceItem.narrative_function_description`, any fields added in Story 5.4, `ThematicNameLists` if relevant).
- [ ] Task 11: Manually verify all Acceptance Criteria.

## Story Wrap Up (Agent Populates After Execution)

- **Agent Model Used:** `<Agent Model Name/Version>`
- **Completion Notes:** {Confirm that `docs/data-models.md` is fully updated. Note any significant model clarifications made.}
- **Change Log:**
  - Initial Draft 