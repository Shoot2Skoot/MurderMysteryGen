# Story 5.2: Orchestrator - Attribute Sub-list Selection

**Status:** Review

## Goal & Context

**User Story:** As a Developer, I want the orchestrator to load the master attribute lists, randomly select a small sub-list (e.g., 2-3 items) from each, and prepare them for input to the `CaseInitializationAgent`.

**Context:** This story builds upon Story 5.1, where master attribute lists were defined. Now, the orchestrator needs to utilize these lists by loading them, performing a random sub-selection, and preparing this data for the `CaseInitializationAgent`. This is a key step in injecting "forced diversity" into the mystery generation process.

## Detailed Requirements

- Implement logic in `main_orchestrator.py` to load all master lists defined in Story 5.1.
- Implement logic to randomly select N (configurable, default 3) items from each master list.
- Structure these sub-lists into a format suitable for passing to `CaseInitializationAgent` (e.g., within its input dictionary).

## Acceptance Criteria (ACs)

- AC1: Orchestrator successfully loads all master attribute lists (Cause of Death, Motive Categories, Occupation Archetypes, Personality Archetypes) from their defined locations.
- AC2: Orchestrator creates sub-lists of a configurable size N (default 3) for each attribute type.
- AC3: The selection process for creating sub-lists is random (or pseudo-random).
- AC4: The generated sub-lists are correctly structured and prepared for passing as input to the `CaseInitializationAgent`.

## Technical Implementation Context

**Guidance:** Use the following details for implementation. Developer agent is expected to follow project standards in `docs/coding-standards.md` and understand the project structure in `docs/project-structure.md`. Only story-specific details are included below.

- **Relevant Files:**
  - Files to Create: None.
  - Files to Modify:
    - `src/mystery_ai/main_orchestrator.py`

- **Key Technologies:**
  - Python (standard library, especially `random` module for selection).

- **API Interactions / SDK Usage:**
  - N/A for this story directly, focuses on internal logic within the orchestrator.

- **UI/UX Notes:**
  - N/A

- **Data Structures:**
  - Input: Master lists (Python `List[str]` or loaded from JSON) from Story 5.1.
  - Output: A dictionary or a structured object containing the sub-selected lists, formatted for `CaseInitializationAgent`'s input. Example:
    ```python
    {
        "cause_of_death_options": ["Poisoning", "Blunt Force Trauma"],
        "motive_category_options": ["Revenge", "Financial Gain"],
        # ... and so on for occupation and personality
    }
    ```
  - A constant for N (number of items to select, e.g., `NUM_ATTRIBUTE_OPTIONS = 3`) should be defined in `main_orchestrator.py` or a config file.

- **Environment Variables:**
  - None specific to this story.

- **Coding Standards Notes:**
  - Follow standards in `docs/coding-standards.md`.
  - Ensure the loading logic is robust to file formats chosen in Story 5.1 (e.g., importing Python lists or parsing JSON).
  - Random selection should be reproducible if a seed is used for testing, but generally should be random per run.

## Testing Requirements

**Guidance:** Verify implementation against the ACs using the following tests. Follow general testing approach in `docs/testing-strategy.md`.

- **Unit Tests:**
  - Test the list loading mechanism for each master list type.
  - Test the random sub-selection logic:
    - Verify it returns the correct number of items (N).
    - Verify selected items are from the master list.
    - Verify randomness over multiple calls (statistical check if feasible, or ensure `random.sample` or similar is used correctly).
  - Test the formatting of the output data structure for the `CaseInitializationAgent`.
- **Integration Tests:**
  - (Potentially as part of Story 5.3's integration) Verify that `CaseInitializationAgent` receives correctly structured sub-lists from the orchestrator.
- **Manual/CLI Verification:**
  - Add temporary logging in the orchestrator to print the loaded master lists and the generated sub-lists to verify correctness during a test run.

## Tasks / Subtasks

- [x] Task 1: Implement logic in `main_orchestrator.py` to load the `cause_of_death` master list.
- [x] Task 2: Implement logic in `main_orchestrator.py` to load the `motive_categories` master list.
- [x] Task 3: Implement logic in `main_orchestrator.py` to load the `occupation_archetypes` master list.
- [x] Task 4: Implement logic in `main_orchestrator.py` to load the `personality_archetypes` master list.
- [x] Task 5: Define a configurable parameter (e.g., constant) for N, the number of items to select for sub-lists (default to 3).
- [x] Task 6: Implement a function to randomly select N items from a given master list.
- [x] Task 7: Use the function from Task 6 to generate sub-lists for each of the four attribute types.
- [x] Task 8: Structure these four sub-lists into a dictionary or object suitable for `CaseInitializationAgent` input.
- [x] Task 9: Add logging to display the selected sub-lists (for debugging/verification).
- [x] Task 10: Write unit tests for list loading and sub-selection logic.
- [x] Task 11: Verify all Acceptance Criteria are met.
  - AC1: Orchestrator successfully loads all master attribute lists (Cause of Death, Motive Categories, Occupation Archetypes, Personality Archetypes) from their defined locations. (Verified by logging and unit tests for _load_master_list)
  - AC2: Orchestrator creates sub-lists of a configurable size N (default 3) for each attribute type. (Verified by implementation and unit tests for selection logic)
  - AC3: The selection process for creating sub-lists is random (or pseudo-random). (Verified by use of random.sample)
  - AC4: The generated sub-lists are correctly structured and prepared for passing as input to the `CaseInitializationAgent`. (Verified by logging and unit tests for structure)

## Story Wrap Up (Agent Populates After Execution)

- **Agent Model Used:** `Gemini 2.5 Pro (via Cursor)`
- **Completion Notes:** Implemented loading of master attribute lists (`cause_of_death`, `motive_categories`, `occupation_archetypes`, `personality_archetypes`) from JSON files in `MurderMysteryGen/config/master_lists/` into `main_orchestrator.py`. Added logic to randomly select a configurable number of items (default 3) from each list using `random.sample`. The selected sub-lists are structured into a dictionary (`attribute_options_for_agent`) intended for future input to the `CaseInitializationAgent` (as per Story 5.3). Logging has been added for these operations. Unit tests for the loading and selection logic have been created in `MurderMysteryGen/tests/orchestration/test_main_orchestrator.py`. The `CaseInitializationAgent` call itself has not yet been modified to accept these new options; this is deferred to Story 5.3.
- **Change Log:**
  - Initial Draft
  - Implemented master list loading, sub-selection, and unit tests. Updated status to Review. 